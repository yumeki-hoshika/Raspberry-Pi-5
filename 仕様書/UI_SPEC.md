# ボアホール監視システム UI仕様書（完成版・最終改訂）

---

## 1. UIの目的

現場および遠隔地から、計測・記録・状態監視・設定変更を
**直感的かつ安全に操作できること**を目的とする。

- 監視（リアルタイム可視化）
- 操作（撮影・録画・LED）
- 記録（CSV / 画像 / 動画）
- 設定・キャリブレーション

を **1画面完結 + 設定画面分離** で提供する。

---

## 2. 画面構成（メイン画面）

### 2.1 全体レイアウト（1画面完結）

```
+--------------------------------------------------------------+
| Camera Section                                               |
| +----------------------+ +----------------------+            |
| | カメラ0 プレビュー   | | カメラ1 プレビュー   |            |
| +----------------------+ +----------------------+            |
| 撮影 / 録画操作        | EV調整（cam0 / cam1）              |
+--------------------------------------------------------------+
| LED Section                                                   |
| LED制御（PWM1 / PWM2：ON/OFF + 明るさ）                      |
+--------------------------------------------------------------+
| Sensor Section                                                |
| +----------+ +----------+ +-------------------------------+ |
| | 方位HUD  | | 距離表示 | | 温湿度・結露リスク表示        | |
| +----------+ +----------+ +-------------------------------+ |
+--------------------------------------------------------------+
| グラフエリア（表示ON/OFF、1 / 5 / 15 分）                    |
+--------------------------------------------------------------+
| [ 設定 ]                                  記録状態 / 警告    |
+--------------------------------------------------------------+
```

---

## 3. セクション別UI仕様

## 3.1 Camera Section

### 表示
- カメラ0 / カメラ1 MJPEGプレビュー
- クリックで全画面表示

### 操作
- **撮影**
  - cam0 / cam1 を同一 sessionID で静止画取得
- **録画**
  - 開始 / 停止トグル
  - 録画中は赤枠・REC表示・経過時間表示
- **EV調整**
  - カメラ別スライダー
  - 200ms デバウンス

---

## 3.2 LED Section

- PWM1 / PWM2
  - ON / OFF
  - 明るさスライダー（0–100%）
- LED状態は即時反映
- 異常時・再起動時は消灯（フェイルセーフ）

---

## 3.3 Sensor Section

### 3.3.1 方位（Heading）

- 円形コンパス HUD
- N / E / S / W 表示
- 数値表示（deg）
- キャリブレーション適用中の場合はアイコン表示

---

### 3.3.2 距離（Distance）

- 距離値（m）
- ステータス表示
  - **VALID**：有効データ
  - **NO_DATA**：有効データ不足
- ステータスに応じた色分け

---

### 3.3.3 温湿度・結露リスク

- 外気 / 筐体内
  - 温度（℃）
  - 湿度（%RH）
- 結露リスク表示
  - SAFE
  - CAUTION
  - WARNING
  - CONDENSING
- WARNING以上で強調表示
- ⓘ ボタンで凡例・判定式・閾値を表示

---

## 4. グラフ仕様

### 4.1 表示可能系列

- 距離（m）
- 内部気温（℃）
- 外部気温（℃）
- 内部湿度（%RH）
- 外部湿度（%RH）

### 4.2 表示制御

- チェックボックスで系列ごとに ON / OFF
- 初期状態は設定ファイルに従う
- 表示OFF系列は描画しない
- 最大 1 / 5 / 15 分の履歴切替

---

## 5. 記録モード・警告UI

### 5.1 記録状態表示

- 記録中：
  - 「Recording」表示
  - 経過時間（分）
- 停止中：
  - 非表示

---

### 5.2 記録継続警告（ポップアップ）

- 記録が **設定時間（分）以上** 継続した場合に表示
- モーダルポップアップで表示

#### 表示内容
- 「記録が N 分継続しています」
- 「継続しますか？停止しますか？」

#### 操作
- **Continue**：記録継続
- **Stop**：記録停止（安全保存）

#### タイムアウト
- 一定時間選択がない場合：
  - 自動的に **継続**
- 警告は一定間隔で再表示される

---

## 6. 設定画面（Settings）

### 6.1 導線
- メイン画面下部の **［設定］ボタン**から遷移
- 別画面 `/settings` またはモーダル

---

### 6.2 設定画面構成

#### 6.2.1 磁気センサ キャリブレーション

- 開始 / 停止・計算 / 保存・適用 / 破棄
- 操作中は進行状況表示
- 保存先：
  - `magnetometer_calibration.json`（単一ファイル）
- 履歴管理なし（常に上書き）
- 適用後は即時反映

---

#### 6.2.2 config.yaml 編集（フォーム）

- 編集可能項目のみ表示
  - センサ周期・中央値ウィンドウ
  - 記録警告設定
  - 温度閾値
  - GPIO割り当て
  - 保存先ディレクトリ
- 型・範囲チェックあり
- 保存時は原子的に更新
- 再起動が必要な項目は明示

---

## 7. 設計方針

- 色だけに依存しない（文字・アイコン併用）
- 操作系（Camera / LED）と監視系（Sensor）を分離
- スクロール不要を前提
- UIは状態遷移が一目で分かること
- 現場で誤操作しにくい配置・確認導線

---

## 8. まとめ

本UIは以下を満たす。

- **1画面での即時監視・操作**
- **安全な記録管理と警告**
- **設定・キャリブレーションの現場対応**
- **Dashcam / ボアホール監視用途に特化したUI構成**
