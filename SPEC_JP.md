# ボアホール監視システム 仕様書（完成版）

## 1. 目的
本システムは Raspberry Pi 5 上で動作するボアホール向け監視・記録システムであり、以下の機能を統合的に提供する。

- 広角カメラ（2系統）による静止画・動画の取得
- LED（2系統）のPWM制御
- 磁気センサによる方位角計測
- 単点LiDARによる距離計測
- 外気／筐体内の温湿度計測
- 露点温度算出および結露リスク判定
- Web UI による可視化・操作

---

## 2. ディレクトリ構造とデータ保存方針

実行時に生成されるすべてのデータは `data/` 配下に集約する。

- 静止画: `data/cam/`
- 動画: `data/video/`
- センサCSVログ: `data/csv/`

---

## 3. カメラ仕様

### 3.1 構成
- Raspberry Pi Camera Module V3（広角）×2
- cam0 / cam1 は CSI ポートの若番順に対応

### 3.2 静止画
- JPEG形式
- 撮影時のカメラ方位（真方位）を EXIF GPSImgDirection に記録
- 磁気偏角およびカメラ取付オフセットを設定ファイルで補正

### 3.3 動画
- MP4（H.264）
- 方位情報は動画ファイルには埋め込まず、同一ディレクトリ内の meta.json に記録する

---

## 4. センサ仕様

| センサ | UI反映周期 | 集計方法 |
|---|---|---|
| 磁気 | 0.5秒 | 中央値 |
| 温湿度 | 1.0秒 | 中央値 |
| 距離 | 1.0秒 | 中央値 |

---

## 5. 結露リスク判定

外気露点温度を Magnus 式で算出し、以下で評価する。

ΔT = 内気温 − 外気露点温度

| 状態 | 判定条件 |
|---|---|
| SAFE | ΔT ≥ safe_delta_c |
| CAUTION | caution_delta_c ≤ ΔT < safe_delta_c |
| WARNING | condensing_delta_c < ΔT < caution_delta_c |
| CONDENSING | ΔT ≤ condensing_delta_c |

---

## 6. UI仕様（要点）
- 外気／筐体内の色分け表示
- 結露リスクに応じた色変更・警告
- インフォメーションボタンによる凡例・閾値表示
- 閾値は設定で変更可能

---

## 7. 備考
本仕様書および設定ファイルは単一の正（Single Source of Truth）として扱う。
